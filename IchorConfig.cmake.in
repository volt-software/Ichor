@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

set(ICHOR_USE_SYSTEM_MIMALLOC @ICHOR_USE_SYSTEM_MIMALLOC@)
set(ICHOR_USE_SDEVENT @ICHOR_USE_SDEVENT@)
set(ICHOR_USE_BOOST_BEAST @ICHOR_USE_BOOST_BEAST@)
set(ICHOR_USE_HIREDIS @ICHOR_USE_HIREDIS@)
set(ICHOR_LTO @ICHOR_LTO@)

if(ICHOR_USE_SYSTEM_MIMALLOC)
    find_dependency(mimalloc REQUIRED)
endif()
if(ICHOR_USE_SDEVENT)
    find_dependency(PkgConfig REQUIRED)
    pkg_check_modules(Systemd IMPORTED_TARGET GLOBAL libsystemd)
endif()
if(ICHOR_USE_BOOST_BEAST)
    find_dependency(boost_coroutine REQUIRED)
endif()
if(ICHOR_USE_HIREDIS)
    find_dependency(hiredis REQUIRED)
endif()
if(ICHOR_LTO)
    include(CheckIPOSupported)
    check_ipo_supported(RESULT LTO_SUPPORTED OUTPUT LTO_ERROR)
    if(LTO_SUPPORTED)
        list(LENGTH BUILDSYSTEM_TARGETS ICHOR_TOTAL_TARGETS)
        if(${ICHOR_TOTAL_TARGET} GREATER "0")
            message(FATAL_ERROR "Ichor LTO enabled but built targets have been defined before inclusion of Ichor, resulting in potential mismatch. Please include ichor first.")
        endif()
        set(CMAKE_POLICY_DEFAULT_CMP0069 NEW)
        set(CMAKE_INTERPROCEDURAL_OPTIMIZATION TRUE)
        if(CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
            set(CMAKE_C_COMPILE_OPTIONS_IPO "-flto=full")
            set(CMAKE_CXX_COMPILE_OPTIONS_IPO "-flto=full")
        endif()
        message(STATUS "Enabled LTO")
    else()
        message(FATAL_ERROR "LTO not supported but Ichor built with LTO: ${LTO_ERROR}")
    endif()
endif()

include("${CMAKE_CURRENT_LIST_DIR}/IchorTargets.cmake")
